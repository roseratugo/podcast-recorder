#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Validate commit message format
# Expected format: <gitmoji> <type>(<scope>): <subject>
# Example: ğŸ“ docs: add README
# Uses all gitmoji emojis from https://gitmoji.dev

commit_msg=$(cat "$1")

# All gitmoji emojis supported
GITMOJI_PATTERN='[ğŸ¨âš¡ğŸ”¥ğŸ›ğŸš‘âœ¨ğŸ“ğŸš€ğŸ’„ğŸ‰âœ…ğŸ”’ğŸ”ğŸ”–ğŸš¨ğŸš§ğŸ’šâ¬‡â¬†ğŸ“ŒğŸ‘·ğŸ“ˆâ™»â•â–ğŸ”§ğŸ”¨ğŸŒâœğŸ’©âªğŸ”€ğŸ“¦ğŸ‘½ğŸššğŸ“„ğŸ’¥ğŸ±â™¿ğŸ’¡ğŸ»ğŸ’¬ğŸ—ƒğŸ”ŠğŸ”‡ğŸ‘¥ğŸš¸ğŸ—ğŸ“±ğŸ¤¡ğŸ¥šğŸ™ˆğŸ“¸âš—ğŸ”ğŸ·ğŸŒ±ğŸš©ğŸ¥…ğŸ’«ğŸ—‘ğŸ›‚ğŸ©¹ğŸ§âš°ğŸ§ªğŸ‘”ğŸ©ºğŸ§±ğŸ§‘â€ğŸ’»ğŸ’¸ğŸ§µğŸ¦ºâœˆ]'

# Check if commit message matches conventional commit format with gitmoji
if ! echo "$commit_msg" | grep -qE "^[[:space:]]*${GITMOJI_PATTERN} [a-z]+(\(.+\))?: .{1,}"; then
  echo "âŒ Commit message does not follow conventional commit format!"
  echo ""
  echo "Expected format: <gitmoji> <type>(<scope>): <subject>"
  echo ""
  echo "Common Types: feat, fix, docs, style, refactor, perf, test, chore, ci, build"
  echo ""
  echo "Examples:"
  echo "  âœ¨ feat(auth): add login page"
  echo "  ğŸ› fix(api): handle null response"
  echo "  ğŸ“ docs: update README"
  echo "  ğŸ”§ chore: update dependencies"
  echo "  ğŸ”¨ chore(scripts): add build script"
  echo "  â™»ï¸ refactor(core): simplify logic"
  echo "  ğŸš€ chore(release): version 1.0.0"
  echo ""
  echo "All gitmoji emojis are supported: https://gitmoji.dev"
  echo ""
  exit 1
fi

exit 0
